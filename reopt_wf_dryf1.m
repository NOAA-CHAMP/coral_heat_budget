1;

diary(fullfile(get_thesis_path('../src'),'reopt_wf_dryf1.log'));
more off
timenow

%{
disp('**********************************************************************');
disp('CONTROL');
disp('**********************************************************************');
stn = optimize_station_heat_budget('dryf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai');
stn=[]; clear stn;

%%%% INITIAL FLOPS
    {'_24_h_lp','SU',               0.66,{[0.015,0.150, 67],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.015,0.150, 67],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err ?4.0,3.7

%%%% SLIGHT IMPROVEMENTS
    {'_24_h_lp','SU',               0.66,{[0.500,1.250, 45],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 96,27 GOOD WINTER
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.250,0.750,342],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 13.2,14.3
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.500,1.250, 45],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 124,42
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.125,0.500, 91],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 56.8,17
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.600, 91],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 73.6,19

%%%% RELAPSE
    {'_24_h_lp','SU',               0.66,{[0.010,0.600, 45],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 64.8,10
    {'_24_h_lp','SU',               0.66,{[0.025,0.600, 45],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 55.5,9.1
    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 45],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 40.8,7.7

%%%% NARROWING IN ON PEAK Kd DAY
    {'_24_h_lp','SU',               0.66,{[0.125,0.500,342],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 33.2,4.3
    {'_24_h_lp','SU',               0.66,{[0.125,0.500,  0],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 29.6,2.8
    {'_24_h_lp','SU',               0.66,{[0.125,0.500, 45],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 22.2,6.2
    {'_24_h_lp','SU',               0.66,{[0.125,0.500, 67],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 19.0,8.8
    {'_24_h_lp','SU',               0.66,{[0.125,0.500, 91],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 16.4,11
    {'_24_h_lp','SU',               0.66,{[0.125,0.500,137],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 15.9,13

    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 91],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 28.1,12

    {'_24_h_lp','SU',               0.66,{[0.050,0.750,  0],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 28.5,5.5
    {'_24_h_lp','SU',               0.66,{[0.050,0.750, 11],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 26.5,5.5
    {'_24_h_lp','SU',               0.66,{[0.050,0.750, 23],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 23.9,6.3
    {'_24_h_lp','SU',               0.66,{[0.050,0.750, 34],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 20.9,7.6
    {'_24_h_lp','SU',               0.66,{[0.050,0.750, 45],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 17.9,9.2%

    {'_24_h_lp','SU',               0.66,{[0.050,0.750, 56],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 15.3,11.0
    {'_24_h_lp','SU',               0.66,{[0.050,0.750, 67],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 13.3,12.9
    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 56],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err ?7.9,9.2
    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 67],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err ?7.9,9.2
    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 79],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 30.9,11.1
    {'_24_h_lp','SU',               0.66,{[0.050,0.500, 56],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err ?7.9,9.2
    {'_24_h_lp','SU',               0.66,{[0.050,0.500, 67],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err ?7.9,9.2
    {'_24_h_lp','SU',               0.66,{[0.050,0.500, 79],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 52.2, 8.7
    {'_24_h_lp','SU',               0.66,{[0.050,0.400, 56],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err ?7.9,9.2
    {'_24_h_lp','SU',               0.66,{[0.050,0.400, 67],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err ?7.9,9.2
    {'_24_h_lp','SU',               0.66,{[0.050,0.400, 79],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 80.8, 8.8

    {'_24_h_lp','SU',               0.66,{[0.025,0.700, 67],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 30.2,11.2
    {'_24_h_lp','SU',               0.66,{[0.025,0.700, 56],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 34.0,9.9
%}

%%%% CONTROL #1: 0.25,0.75,342: err  7.7,5.0
%%%% CONTROL #2: 0.20,0.80,342: err 17.0,2.3
for cop={ ...
    {'_24_h_lp','SU',               0.66,{[0.200,0.500,354],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 26.1,1.8 QLHx0.96
    {'_24_h_lp','SU',               0.66,{[0.200,0.500,354],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 22.2,1.6 QLHx0.94
    {'_24_h_lp','SU',               0.66,{[0.150,0.500,354],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 17.3,1.3 QLHx0.90
        };

    op = cop{:};
    lp = op{1};
    sc = op{2};
    wf = op{3};
    kd = op(4);
    ad = op(5);
    kt = op(6);
    kb = op{7};
    disp('**********************************************************************');
    disp(lp);
    disp({sc,wf,kd});
    disp(kd{:});
    disp(ad{:});
    disp(kt{:});
    disp(kb);
    disp('**********************************************************************');

    %stn = optimize_station_heat_budget('dryf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai',{'qafld','ncep_spechumid'},struct('override_light_kds',{{[0.18,0.5,354]}},'override_do_warm_adj',false));
    stn = optimize_station_heat_budget('dryf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai',{'Q0_LOWPASS',lp},struct('hc_scaling',sc,'hc_warming_factor',wf,'override_light_kds',kd,'override_advection_factors',ad,'override_k_thetas',kt,'keep_bad_dates',kb,'override_do_warm_adj',false,'override_qlh_adj',0.90));
    stn=[]; clear stn;
    pause(1);

end;

timenow
more on
diary off
