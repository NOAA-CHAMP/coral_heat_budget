1;

diary(fullfile(get_thesis_path('../src'),'reopt_wf_fwyf1.log'));
more off
timenow

disp('**********************************************************************');
disp('CONTROL');
disp('**********************************************************************');
stn = optimize_station_heat_budget('fwyf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai');
stn=[]; clear stn;

%{
%CONTROL err 15.6,1.0
    {'_24_h_lp','SU',0.66,{[.145,.20,325]}},... %USF Kd err 63.4,3.4
    {'_24_h_lp','SU',0.66,{[.038,.25, 67]}},... %MLRF1 optimal err 27.0,1.3
    {'_24_h_lp','SU',0.66,{[.038,.25, 56]}},... %err 25.2,1.2
    {'_24_h_lp','UU',0.66,{[.038,.25, 67]}},... %err  9.5,3.1
    {'_24_h_lp','SU',0.66,{[.025,.20, 67]}},... %err  6.4,1.0 BEST SO FAR
    {'_24_h_lp','UU',0.50,{[.025,.200, 67],[.025,.175, 67],[.010,.175, 67],[.025,.200, 91],[.025,.175, 91],[.010,.175, 91],}},... %err 30.0,3.0

    {'_24_h_lp','SU',0.66,{[.025,.200, 91],[.025,.175, 91],}},... %0.025,0.175,91: err  5.4,0.9
    {'_24_h_lp','SU',0.75,{[.025,.200, 67],[.025,.175, 67],[.010,.175, 67],[.025,.200, 91],[.025,.175, 91],[.010,.175, 91],}},... %0.025,0.20,91: err  4.5,0.7

    {'_24_h_lp','UU',0.33,{[.025,.200, 91],[.025,.175, 91],}},... %err 12.2,0.8
    {'_24_h_lp','ADAPTIVE',0.66,{[.025,.200, 91],[.025,.175, 91],}},... %err 20.8,2.4

    {'_24_h_lp','SU',0.75,{[.025,.200, 91],[.025,.175, 91],}},... %0.025,0.200, 91: err  4.6,0.6 - BEST SO FAR

    {'_24_h_lp','SU',0.75,{[.025,.200, 91],[.025,.175, 91],},{[0,0,91],[0,0.5,91],[0,1,91],[0,1,45]},},... %0.025,0.200, 91: err  4.6,0.6
    {'_24_h_lp','ADAPTIVE',0.33,{[.025,.200, 91],[.025,.175, 91],},{[0,0,91],[0,0.5,91],[0,1,91],[0,1,45]},},... %err 20.8,2.4

%%%% IMPROVING
    {'_24_h_lp','SU',0.75,{[.025,.200, 67],[.025,.175, 67],[.025,.200, 91],[.025,.175, 91],[.025,.200,137],[.025,.175,137],},{[0,1,91]},},... %0.025,0.200, 91: err  4.6,0.6
    {'_24_h_lp','SU',0.66,{[.025,.200, 67],[.025,.175, 67],[.025,.200, 91],[.025,.175, 91],[.025,.200,137],[.025,.175,137],},{[0,1,91]},},... %0.025,0.175,91: err  5.4,0.9
    {'_24_h_lp','ADAPTIVE',0.33,{[.025,.200, 45],[.025,.175, 45],[.025,.200, 91],},{[0,0,91],[0,0.5,91]},},... %0.33;.025,.200,91;0,0,91: err  9.5,0.8
    {'_24_h_lp','ADAPTIVE',0.25,{[.025,.200, 45],[.025,.175, 45],[.025,.200, 91],[.025,.175, 91],},{[0,0,91],[0,0.5,91]},},... %0.25;.025.175,91;0,0,91: err 13.6,1.1

%%%% NEARING OPTIMUM
    {'_24_h_lp','ADAPTIVE',0.33,{[.025,.175, 91],},{[0,0,91]},},... %err  4.7,0.8
    {'_24_h_lp','SU',0.66,{[.025,.200, 67],[.025,.175, 67],[.025,.200, 91],[.025,.175, 91],[.025,.200,137],[.025,.175,137],},{[0,0.5,102]},},... %Ad~0,.5,91: Kd~0.025,0.200, 91: err  9.4,0.6 ; Kd~0.025,0.200,137: err  3.9,0.9

    {'_24_h_lp','SU',0.66,{[.025,.200,120],[.025,.200,102],[.025,.225, 91],},{[0,0.5,102]},},... %0.025,0.200,120: err  4.2,0.5 ; 0.025,0.225, 91: err  4.7,0.3
    {'_24_h_lp','ADAPTIVE',0.25,{[.015,.175, 91],[.015,.150, 91],[.025,.175, 67],[.025,.175, 79],},{[0,0,91]},},... %0.015,.175,91: err  4.6,0.6; 0.025,.175, 67: err  5.8,0.5

    {'_24_h_lp','SU',0.66,{[.025,.200,120],},{[0,0.5,102]},},... %err  4.2,0.5
    {'_24_h_lp','SU',0.66,{[.025,.225, 91],},{[0,0.5,102]},},... %err  5.9,0.4
    {'_24_h_lp','ADAPTIVE',0.25,{[.025,.175, 67],},{[0,0,91]},},... %err  5.5,0.6
    {'_24_h_lp','ADAPTIVE',0.25,{[.025,.175, 79],},{[0,0,91]},},... %err  9.1,0.6

%%%% OPTIMUM OF EACH TYPE
    {'_24_h_lp','SU',0.66,{[.025,.225,102],},{[0,0.5,102]},},... %err  3.6,0.3
    {'_24_h_lp','ADAPTIVE',0.25,{[.025,.175, 72],},{[0,0,91]},},... %err  6.9,0.5
    {'_24_h_lp','ADAPTIVE',0.33,{[.025,.175, 91],},{[0,0,91]},},... %err  4.7,0.8

%%%% NEW CONTROL
    {'_24_h_lp','SU',                0.66,{[.025,.225,102],},{[0,0.5,102]},{[0,20, 45]},},... %err  3.6,0.3 (1993-2011?)
    {'_24_h_lp','SU',                0.66,{[.025,.225,102],},{[0,0.5,102]},{[0,20, 45]},},... %err  4.4,0.3 (1993-2012)
    {'_24_h_lp','SU',                0.66,{[.025,.250,102],},{[0,0.5,102]},{[0,20, 45]},},... %err  3.8,0.5
    {'_24_h_lp','UNSTEADY_SEASONAL', 0.66,{[.025,.225,102],},{[0,0.5,102]},{[0,20, 45]},},... %err  6.8,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL', 0.66,{[.025,.250,102],},{[0,0.5,102]},{[0,20, 45]},},... %err  3.3,0.8
%}

for cop={ ...
    {'_24_h_lp','UNSTEADY_SEASONAL', 0.66,{[.025,.275,102],[.025,.275, 91],[.025,.250, 91],[.050,.250, 91],[.050,.250, 73],[.025,.250, 45],},{[0,0.5,102]},{[0,20, 45]},},... %err  3.3,0.8
        };

    op = cop{:};
    lp = op{1};
    sc = op{2};
    wf = op{3};
    kd = op(4);
    ad = op(5);
    kt = op(6);
    disp('**********************************************************************');
    disp(lp);
    disp({sc,wf,kd});
    disp(kd{:});
    disp(ad{:});
    disp(kt{:});
    disp('**********************************************************************');

    stn = optimize_station_heat_budget('fwyf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai',{'Q0_LOWPASS',lp},struct('hc_scaling',sc,'hc_warming_factor',wf,'override_light_kds',kd,'override_advection_factors',ad,'override_k_thetas',kt));
    stn=[]; clear stn;
    pause(1);

end;

timenow
more on
diary off
