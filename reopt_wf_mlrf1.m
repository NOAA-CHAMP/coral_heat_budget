1;

diary reopt_wf_mlrf1.log
more off
timenow

disp('**********************************************************************');
disp('CONTROL');
disp('**********************************************************************');
stn = optimize_station_heat_budget('mlrf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai');
stn=[]; clear stn;

%{
for cop={ ...
        {'US',.4,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45]}},...
        {'US',.5,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45]}},... %2
        {'US',.6,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45],[.050,.35,45]}},...
        {'US',.8,{[.001,.25,91],[.025,.25,91],[.050,.25,91],[.100,.25,91],[.050,.35,45]}},...
        {'UU',.4,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45]}},...
        {'UU',.5,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45]}},...
        {'UU',.6,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45],[.050,.35,45]}},... %7
        {'UU',.8,{[.001,.25,91],[.025,.25,91],[.050,.25,91],[.100,.25,91],[.050,.35,45]}},... %8
        {'SU',.4,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45]}},...
        {'SU',.5,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45]}},...
        {'SU',.6,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45],[.050,.35,45]}},... %11
        {'SU',.8,{[.001,.25,91],[.025,.25,91],[.050,.25,91],[.100,.25,91],[.050,.35,45]}},...
        {'SS',.4,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45]}},...
        {'SS',.5,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45]}},...
        {'SS',.6,{[.001,.25,45],[.025,.25,45],[.050,.25,45],[.100,.25,45],[.050,.35,45]}},...
        {'SS',.8,{[.001,.25,91],[.025,.25,91],[.050,.25,91],[.100,.25,91],[.050,.35,45]}},...
        };

for cop={ ...
        {'_24_h_lp','US',.5,{[.025,.25,45],[.033,.25,45],[.050,.25,45],[.050,.25,91]}},... %2
        {'_24_h_lp','UU',.6,{[.050,.25, 0],[.050,.25,22],[.050,.25,45],[.050,.25,67],[.038,.25,45]}},... %7
        {'_24_h_lp','UU',.7,{[.050,.35,45]}},... %8
        {'_24_h_lp','SU',.6,{[.050,.25, 0],[.050,.25,22],[.050,.25,45],[.050,.25,67],[.038,.25,45]}},... %11
        };

for cop={ ...
        {'_24_h_lp','UU',.6,{[.050,.25,67],[.050,.25,45]}},... %7
        {'_24_h_lp','UU',.7,{[.050,.35,45],[.075,.35,45]}},... %8
        {'_24_h_lp','SU',.6,{[.050,.25,45],[.038,.25,45],[.050,.20,40],[.038,.25,67]}},... %7
        };

%        {'_48_h_lp','US',1.0,{[.050,.35,91]}},... %CONTROL: err 5.0, 1.3

for cop={ ...
        {'_24_h_lp','SU',0.6,{[.050,.25,45],[.038,.25,45],[.050,.20,40],[.038,.25,67]}},... %err 13.2,0.6
        {'_24_h_lp','UU',0.6,{[.050,.25,67],[.050,.25,56],[.050,.23,56],[.030,.25,56]}},... %err 15.9,0.8
        };

        % {'_48_h_lp','US',1.00,{[.050,.35,91]}},... %CONTROL: err  5.0,1.3
        % {'_24_h_lp','UU',0.60,{[.050,.25,67]}},... %err 15.9,0.8
        % {'_24_h_lp','SU',0.66,{[.160,.22, 7]}},... %USF Kd - 412-555nm
        % {'_24_h_lp','SU',0.66,{[.080,.11, 5]}},... %USF Kd - all except 645nm
        % {'_24_h_lp','SU',0.60,{[.038,.25,56]}},... %err 10.6,0.4

%%%% APPROACHING OPTIMUM
    {'_24_h_lp','SU',0.66,{[.038,.250,67]}},... %err  7.2,0.4
    {'_24_h_lp','SU',0.66,{[.038,.250,56]}},... %err  6.4,0.7
    {'_24_h_lp','UU',0.60,{[.050,.250,56]}},... %err 14.1,0.7
%}

for cop={ ...
    {'_24_h_lp','SU',0.66,{[.050,.225,67]},{[0.00,1.0, 45]}},... %err  7.2,0.4
    {'_24_h_lp','SU',0.66,{[.038,.250,67]},{[0.00,0.5,102]}},... %err  ?.2,0.4
    {'_24_h_lp','SU',0.66,{[.050,.225,56]},{[0.00,1.0, 45]}},... %err  6.4,0.7
    {'_24_h_lp','SU',0.66,{[.038,.250,56]},{[0.00,0.5,102]}},... %err  ?.4,0.7
        };

    op = cop{:};
    lp = op{1};
    sc = op{2};
    wf = op{3};
    kd = op(4);
    ad = op(5);
    disp('**********************************************************************');
    disp(lp);
    disp({sc,wf,kd});
    disp(kd{:});
    disp(ad{:});
    disp('**********************************************************************');

    stn = optimize_station_heat_budget('mlrf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai',{'Q0_LOWPASS',lp},struct('hc_scaling',sc,'hc_warming_factor',wf,'override_light_kds',kd,'override_advection_factors',ad));
    %appendtitlename([' ',strrep(lp,'_','\_'),' ',sc,',wf=',num2str(wf)]);
    stn=[]; clear stn;
    pause(1);

end;

timenow
more on
diary off
