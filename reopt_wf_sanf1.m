1;

diary(fullfile(get_thesis_path('../src'),'reopt_wf_sanf1.log'));
more off
timenow

%{
disp('**********************************************************************');
disp('CONTROL');
disp('**********************************************************************');
stn = optimize_station_heat_budget('sanf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai');
stn=[]; clear stn;

disp('**********************************************************************');
disp('CONTROL wf=0.66');
disp('**********************************************************************');
stn = optimize_station_heat_budget('sanf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai',{},struct('hc_warming_factor',0.66));
stn=[]; clear stn;

    {'_24_h_lp','SS',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.2,1.0
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.2,1.0
    {'_24_h_lp','SU',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.2,1.0
    {'_24_h_lp','UU',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.2,1.0
    {'_24_h_lp','ADAPTIVE',         0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.2,1.0
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.2,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.2,1.0
    {'_24_h_lp','SS',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  ?.2,1.0
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  ?.2,1.0
    {'_24_h_lp','SU',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  ?.2,1.0
    {'_24_h_lp','UU',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  ?.2,1.0
    {'_24_h_lp','ADAPTIVE',         0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  ?.2,1.0
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  ?.2,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  ?.2,1.0

    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  5.0,2.5
    {'_24_h_lp','SU',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err 20.9,4.0
    {'_24_h_lp','UU',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  6.9,2.4
    {'_24_h_lp','SU',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err 23.0,4.1
    {'_24_h_lp','ADAPTIVE',         0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  9.6,2.7
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},false},... %err  6.4,2.6
    ...
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,0.25, 45]},{[0,20, 45]},true },... %err 20.3,1.7
    {'_24_h_lp','SU',               0.66,{[0.025,0.300, 81],},{[0.00,0.25, 45]},{[0,20, 45]},true },... %err 17.2,3.0
    {'_24_h_lp','UU',               0.66,{[0.025,0.300, 81],},{[0.00,0.25, 45]},{[0,20, 45]},true },... %err 22.1,2.7
    {'_24_h_lp','SU',               0.66,{[0.025,0.300, 81],},{[0.00,0.25, 45]},{[0,20, 45]},false},... %err 17.0,2.9
    {'_24_h_lp','ADAPTIVE',         0.66,{[0.025,0.300, 81],},{[0.00,0.25, 45]},{[0,20, 45]},false},... %err 28.5,3.5
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,0.25, 45]},{[0,20, 45]},false},... %err 20.0,1.7

%%%% IMPROVING
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  5.0,2.5
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,0.25, 45]},{[0,20, 45]},true },... %err 20.3,1.7
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err 13.1,1.7
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 45],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err  8.8,1.7
    {'_24_h_lp','US',               0.66,{[0.050,0.300, 45],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err 19.4,2.1
    {'_24_h_lp','US',               0.66,{[0.050,0.300, 91],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err 23.0,2.4
    {'_24_h_lp','US',               0.66,{[0.025,0.200, 81],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err  7.7,1.5

%%%% EXPERIMENTS
    {'_24_h_lp','US',               0.66,{[0.025,0.200, 45],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err  4.0,1.7
    {'_24_h_lp','SU',               0.66,{[0.025,0.200, 45],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err 37.7,5.2
    {'_24_h_lp','SU',               0.66,{[0.025,0.200, 45],},{[0.00,0.25, 45]},{[0,20, 45]},true },... %err  5.1,1.6
    {'_24_h_lp','SU',               0.66,{[0.025,0.200, 45],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err  ?.3,1.7
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.200, 45],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.0,2.5
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.200, 45],},{[0.00,0.25, 45]},{[0,20, 45]},true },... %err  ?.3,1.7
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.200, 45],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err  ?.3,1.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  ?.0,2.5
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 81],},{[0.00,0.25, 45]},{[0,20, 45]},true },... %err  ?.3,1.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 81],},{[0.00,0.50, 45]},{[0,20, 45]},true },... %err  ?.3,1.7

    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{[0.00,1.00, 45]},{[0,20, 45]},true },... %err  5.0,2.5

    {'_24_h_lp','US',               0.66,{[0.025,0.300, 81],},{0},              {[0,20, 45]},true },... %err 29.6,2.4
    {'_24_h_lp','SS',               0.66,{[0.025,0.300, 81],},{0},              {[0,20, 45]},true },... %err 32.2,3.0
    {'_24_h_lp','SU',               0.66,{[0.025,0.300, 81],},{0},              {[0,20, 45]},true },... %err 33.7,4.2
    {'_24_h_lp','UU',               0.66,{[0.025,0.300, 81],},{0},              {[0,20, 45]},true },... %err 34.0,3.7
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.300, 81],},{0},              {[0,20, 45]},true },... %err 25.7,2.9
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 81],},{0},              {[0,20, 45]},true },... %err 25.6,2.4

%%%% (BAD) EXPERIMENTS
    {'_24_h_lp','SS',               0.66,{[0.025,0.300, 45],},{0},              {[0,20, 45]},true },... %err ?2.2,3.0
    {'_24_h_lp','SU',               0.66,{[0.025,0.300, 45],},{0},              {[0,20, 45]},true },... %err ?3.7,4.2
    {'_24_h_lp','US',               0.66,{[0.025,0.300, 45],},{0},              {[0,20, 45]},true },... %err ?9.6,2.4
    {'_24_h_lp','UU',               0.66,{[0.025,0.300, 45],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.300, 45],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','SS',               0.66,{[0.025,0.300,  0],},{0},              {[0,20, 45]},true },... %err ?2.2,3.0
    {'_24_h_lp','SU',               0.66,{[0.025,0.300,  0],},{0},              {[0,20, 45]},true },... %err ?3.7,4.2
    {'_24_h_lp','US',               0.66,{[0.025,0.300,  0],},{0},              {[0,20, 45]},true },... %err ?9.6,2.4
    {'_24_h_lp','UU',               0.66,{[0.025,0.300,  0],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.300,  0],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300,  0],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    ...
    {'_24_h_lp','SS',               0.66,{[0.025,0.250, 45],},{0},              {[0,20, 45]},true },... %err ?2.2,3.0
    {'_24_h_lp','SU',               0.66,{[0.025,0.250, 45],},{0},              {[0,20, 45]},true },... %err ?3.7,4.2
    {'_24_h_lp','US',               0.66,{[0.025,0.250, 45],},{0},              {[0,20, 45]},true },... %err ?9.6,2.4
    {'_24_h_lp','UU',               0.66,{[0.025,0.250, 45],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.250, 45],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','SS',               0.66,{[0.025,0.250,  0],},{0},              {[0,20, 45]},true },... %err ?2.2,3.0
    {'_24_h_lp','SU',               0.66,{[0.025,0.250,  0],},{0},              {[0,20, 45]},true },... %err ?3.7,4.2
    {'_24_h_lp','US',               0.66,{[0.025,0.250,  0],},{0},              {[0,20, 45]},true },... %err ?9.6,2.4
    {'_24_h_lp','UU',               0.66,{[0.025,0.250,  0],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.025,0.250,  0],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250,  0],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7

%%%% MUCH IMPROVED but SEP-OCT Catastrophe
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 45],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 67],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 67],},{0},              {[0,20, 45]},true },... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{0},              {0},         true },... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 45],},{0},              {0},         true },... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 67],},{0},              {0},         true },... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.300, 67],},{0},              {0},         true },... %err ?4.0,3.7

%%%% Catastrophe reduced
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{0},              {[0,20, 45]},true },... %err 18.7,1.5
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{[0.00,0.25, 91]},{[0,20, 45]},true },... %BAD 11.2,1.2
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{[0.00,0.25,137]},{[0,20, 45]},true },... %err 16.1,1.2
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{[0.00,0.25,182]},{[0,20, 45]},true },... %err 18.6,1.3
%}

%%%% CONTROL: err 13.4,2.4
%%%% CONTROL wf=0.66: err 18.7,3.0
%%%% CONTROL Kd=0,20,45 wf=0.66: err 20.0,1.0
for cop={ ...
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{0},              {[0,20, 45]},false},... %err ?8.7,1.5
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{[0.00,0.25,  0]},{[0,20, 45]},false},... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{[0.00,0.25, 45]},{[0,20, 45]},false},... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{[0.00,0.25, 91]},{[0,20, 45]},false},... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{[0.00,0.25,137]},{[0,20, 45]},false},... %err ?4.0,3.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.025,0.250, 45],},{[0.00,0.25,182]},{[0,20, 45]},false},... %err ?4.0,3.7
        };

    op = cop{:};
    lp = op{1};
    sc = op{2};
    wf = op{3};
    kd = op(4);
    ad = op(5);
    kt = op(6);
    kb = op{7};
    disp('**********************************************************************');
    disp(lp);
    disp({sc,wf,kd});
    disp(kd{:});
    disp(ad{:});
    disp(kt{:});
    disp(kb);
    disp('**********************************************************************');

    stn = optimize_station_heat_budget('sanf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai',{'Q0_LOWPASS',lp},struct('hc_scaling',sc,'hc_warming_factor',wf,'override_light_kds',kd,'override_advection_factors',ad,'override_k_thetas',kt,'keep_bad_dates',kb));
    stn=[]; clear stn;
    pause(1);

end;

timenow
more on
diary off
