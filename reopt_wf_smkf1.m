1;

diary(fullfile(get_thesis_path('../src'),'reopt_wf_smkf1.log'));
more off
timenow

%{
disp('**********************************************************************');
disp('CONTROL');
disp('**********************************************************************');
stn = optimize_station_heat_budget('smkf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai');
stn=[]; clear stn;

    {'_24_h_lp','SU',0.66,{[0.100,0.600, 70],[0.100,0.600, 57],[0.100,0.600, 91],},{[0,0.25, 91]},},... %err  ?
    {'_24_h_lp','SU',0.66,{[0.100,0.600, 70],[0.100,0.600, 57],[0.100,0.600, 91],},{[0,0.50, 91]},},... %err  ?
    {'_24_h_lp','SU',0.66,{[0.100,0.500, 11],[0.100,0.500, 33],[0.100,0.500, 57],},{[0,0.50, 91]},},... %err  ?
    {'_24_h_lp','SU',0.66,{[0.100,0.500, 11],[0.100,0.500, 33],[0.100,0.500, 57],},{[0,0, 91]},},... %err  ?

    {'_24_h_lp','SU',0.66,{[0.100,0.500, 11],[0.100,0.500, 33],[0.100,0.500, 57],},{[0,1.00, 91]},},... %err  ?
    {'_24_h_lp','SU',0.66,{[0.100,0.500, 11],},{[0,1.00, 91]},},... %err 11.8,1.6
    {'_24_h_lp','SU',0.66,{[0.100,0.500, 57],},{[0,1.00, 91]},},... %err 14.9,1.5

    {'_24_h_lp','ADAPTIVE',0.25,{[0.100,0.500, 33],},{[0,1.00, 91]},},... %err 75.1,7.2

%%%% GETTING BETTER
%%%% OLD CONTROL:     {'_24_h_lp','SU',0.66,{[0.100,0.500, 33],},{[0,1.00, 91]},},... %err 12.9,1.3
    {'_24_h_lp','SU',      0.66,{[0.100,0.500, 33],[0.100,0.500, 57],[0.100,0.500, 69],[0.050,0.600, 33],[0.050,0.600, 57],[0.050,0.600, 69],},{[0,1.00, 91]},},... %.05,.6,69 err  9.0,1.1
    {'_24_h_lp','UU',      0.66,{[0.100,0.500, 33],[0.100,0.500, 57],[0.100,0.500, 69],[0.050,0.600, 33],[0.050,0.600, 57],[0.050,0.600, 69],},{[0,1.00, 91]},},... %.05,.6,69 err  8.2,1.0
    {'_24_h_lp','US',      0.66,{[0.100,0.500, 33],[0.100,0.500, 57],[0.100,0.500, 69],[0.050,0.600, 33],[0.050,0.600, 57],[0.050,0.600, 69],},{[0,1.00, 91]},},... %.05,.6,69 err  8.6,1.5
    {'_24_h_lp','ADAPTIVE',0.66,{[0.100,0.500, 33],[0.100,0.500, 57],[0.100,0.500, 69],[0.050,0.600, 33],[0.050,0.600, 57],[0.050,0.600, 69],},{[0,1.00, 91]},},... %.05,.6,69 err  8.1,1.0
    {'_24_h_lp','STEADY_SEASONAL',0.66,{[0.100,0.500, 33],[0.100,0.500, 57],[0.100,0.500, 69],[0.050,0.600, 33],[0.050,0.600, 57],[0.050,0.600, 69],},{[0,1.00, 91]},},... %.05,.6,69 err  9.4,1.3 ; .05,.6,57 err 10.3,1.1

%%%% APPROACHING ACCEPTABLE
    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 69],},{[0,1.00, 91]},},... %err  8.9,1.1
    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 80],},{[0,1.00, 91]},},... %err  7.9,1.3
    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 91],},{[0,1.00, 91]},},... %err  7.7,1.6
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.600, 69],},{[0,1.00, 91]},},... %err  7.8,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.600, 80],},{[0,1.00, 91]},},... %err  7.1,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.600, 91],},{[0,1.00, 91]},},... %err  6.9,1.2
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.300, 80],},{[0,1.00, 91]},},... %err 23.3,2.2

%%%% ACCEPTABLE
    {'_24_h_lp','SU',               0.66,{[0.050,0.650, 69],},{[0,1.00, 91]},},... %err  8.3,1.1
    {'_24_h_lp','SS',               0.66,{[0.050,0.650, 69],},{[0,1.00, 91]},},... %err 19.0,2.1
    {'_24_h_lp','US',               0.66,{[0.050,0.650, 69],},{[0,1.00, 91]},},... %err  7.7,1.4
    {'_24_h_lp','UU',               0.66,{[0.050,0.650, 69],},{[0,1.00, 91]},},... %err  7.9,1.0
    {'_24_h_lp','STEADY_SEASONAL',  0.66,{[0.050,0.650, 69],},{[0,1.00, 91]},},... %err  ?.3,2.2
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.650, 69],},{[0,1.00, 91]},},... %err  7.4,1.0
    {'_24_h_lp','STEADY_SEASONAL',  0.67,{[0.025,0.650, 69],[0.025,0.600, 69],[0.025,0.700, 69],},{[0,1.00, 91]},},... %err  ?.3,2.2

%%%% IMPROVING
    {'_24_h_lp','SU',               0.67,{[0.050,0.600, 91],[0.025,0.700, 69],[0.025,0.700, 91],[0.010,0.750, 69],},{[0,1.00, 91]},},... %.05,.6,91: err  7.5,1.5 ; .025,.7,69: err 14.6,1.3
    {'_24_h_lp','UNSTEADY_SEASONAL',0.67,{[0.050,0.600, 91],[0.025,0.700, 69],[0.025,0.700, 91],[0.010,0.750, 69],},{[0,1.00, 91]},},... %.05,.6,91: err  6.8,1.2 ; .025,.7,69: err 11.9,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.67,{[0.050,0.700, 69],[0.025,0.700, 80],[0.050,0.700, 80],},{[0,1.00, 91]},},... %.05,.7  69: err  7.3,1.0
    {'_24_h_lp','SU',               0.66,{[0.050,0.600, 69],},{[0,1.00, 91]},},... %err  8.9,1.1
    {'_24_h_lp','SU',               0.66,{[0.050,0.450, 69],},{[0,1.00, 45]},},... %err 11.4,1.1

%%%% BEST SO FAR
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.800, 69],[0.050,0.750, 69],[0.050,0.700, 69],[0.050,0.650, 69],[0.050,0.600, 69],[0.050,0.550, 69],[0.050,0.500, 69],},{[0,1.00, 91]},},... %.05,.60, 69: err  6.2,0.9 ; .05,.55, 69: err  6.6,0.8
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.950, 69],[0.050,0.900, 69],[0.050,0.850, 69],[0.050,0.800, 69],[0.050,0.750, 69],[0.050,0.700, 69],[0.050,0.650, 69],[0.050,0.600, 69],[0.050,0.550, 69],[0.050,0.500, 69],[0.050,0.450, 69],[0.050,0.400, 69],[0.050,0.350, 69],[0.050,0.300, 69],},{[0,1.00, 45]},},... %.05,.50, 69: err  7.4,0.8 ; .05,.45, 69: err  7.5,0.7

%%%% APPROACHING OPTIMAL
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.100,0.500, 33],[0.050,0.450, 69],},{[0,1.00, 45]},{[0,20, 45]},},... %err  7.5,0.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.100,0.500, 33],[0.050,0.600, 69],},{[0,1.00, 91]},{[0,20, 45]},},... %err  6.2,0.9
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.100,0.500, 33],[0.050,0.450, 69],},{[0,1.00, 45]},{[0,20, 45]},},... %err  7.5,0.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.100,0.500, 33],[0.050,0.600, 69],},{[0,0.50, 91]},{[0,20, 45]},},... %err  5.5,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.100,0.500, 33],[0.050,0.450, 69],},{[0,0.50, 45]},{[0,20, 45]},},... %err  7.1,0.8
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.100,0.500, 33],[0.050,0.600, 69],},{[0,0.25, 91]},{[0,20, 45]},},... %err  5.3,1.1
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.100,0.500, 33],[0.050,0.450, 69],},{[0,0.25, 45]},{[0,20, 45]},},... %err  7.1,0.8

%%%% BEST SO FAR
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.450, 69],},{[0,1.00, 45]},{[0,20, 45]},},... %err  9.6,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.450, 57],},{[0,1.00, 45]},{[0,20, 45]},},... %err 11.0,1.3
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.450, 45],},{[0,1.00, 45]},{[0,20, 45]},},... %err 12.5,1.7
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.066,0.450, 69],},{[0,1.00, 45]},{[0,20, 45]},},... %err  9.2,0.9
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.066,0.450, 57],},{[0,1.00, 45]},{[0,20, 45]},},... %err  8.8,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.066,0.450, 45],},{[0,1.00, 45]},{[0,20, 45]},},... %err  8.8,1.2

    % {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.066,0.450, 69],},{[0,1.00, 45]},{[0,20, 45]},},... %err  9.2,0.9
    % {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.066,0.450, 57],},{[0,1.00, 45]},{[0,20, 45]},},... %err  8.8,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.075,0.450, 69],},{[0,1.00, 45]},{[0,20, 45]},},... %err 11.0,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.67,{[0.066,0.450, 57],},{[0,1.00, 45]},{[0,20, 45]},},... %err  8.7,1.0
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.066,0.450, 62],},{[0,1.00, 45]},{[0,20, 45]},},... %err  8.9,0.9
%}

%%%% CONTROL:     {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.050,0.600, 91],},{[0,1.00, 91]},},... %err  6.9,1.2
for cop={ ...
    {'_24_h_lp','UNSTEADY_SEASONAL',0.66,{[0.066,0.450, 69],},{[0,1.00, 45]},{[0,20, 45]},},... %err  9.2,0.9
        };

    op = cop{:};
    lp = op{1};
    sc = op{2};
    wf = op{3};
    kd = op(4);
    ad = op(5);
    kt = op(6);
    disp('**********************************************************************');
    disp(lp);
    disp({sc,wf,kd});
    disp(kd{:});
    disp(ad{:});
    disp(kt{:});
    disp('**********************************************************************');

    stn = optimize_station_heat_budget('smkf1','erai','avhrr_weekly','ndbc','tpxo_tide','erai',{'Q0_LOWPASS',lp},struct('hc_scaling',sc,'hc_warming_factor',wf,'override_light_kds',kd,'override_advection_factors',ad,'override_k_thetas',kt));
    stn=[]; clear stn;
    pause(1);

end;

timenow
more on
diary off
